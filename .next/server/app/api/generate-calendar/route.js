"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate-calendar/route";
exports.ids = ["app/api/generate-calendar/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-calendar%2Froute&page=%2Fapi%2Fgenerate-calendar%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-calendar%2Froute.ts&appDir=C%3A%5CRepos%5Creddit_mastermind_assessment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5Creddit_mastermind_assessment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-calendar%2Froute&page=%2Fapi%2Fgenerate-calendar%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-calendar%2Froute.ts&appDir=C%3A%5CRepos%5Creddit_mastermind_assessment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5Creddit_mastermind_assessment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Repos_reddit_mastermind_assessment_app_api_generate_calendar_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate-calendar/route.ts */ \"(rsc)/./app/api/generate-calendar/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate-calendar/route\",\n        pathname: \"/api/generate-calendar\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate-calendar/route\"\n    },\n    resolvedPagePath: \"C:\\\\Repos\\\\reddit_mastermind_assessment\\\\app\\\\api\\\\generate-calendar\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Repos_reddit_mastermind_assessment_app_api_generate_calendar_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate-calendar/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZS1jYWxlbmRhciUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZ2VuZXJhdGUtY2FsZW5kYXIlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZnZW5lcmF0ZS1jYWxlbmRhciUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDUmVwb3MlNUNyZWRkaXRfbWFzdGVybWluZF9hc3Nlc3NtZW50JTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDUmVwb3MlNUNyZWRkaXRfbWFzdGVybWluZF9hc3Nlc3NtZW50JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUM4QjtBQUMzRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NsaWRlZm9yZ2UtcmVkZGl0LWNhbGVuZGFyLz9kMDcxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFJlcG9zXFxcXHJlZGRpdF9tYXN0ZXJtaW5kX2Fzc2Vzc21lbnRcXFxcYXBwXFxcXGFwaVxcXFxnZW5lcmF0ZS1jYWxlbmRhclxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGUtY2FsZW5kYXIvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9nZW5lcmF0ZS1jYWxlbmRhclwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvZ2VuZXJhdGUtY2FsZW5kYXIvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxSZXBvc1xcXFxyZWRkaXRfbWFzdGVybWluZF9hc3Nlc3NtZW50XFxcXGFwcFxcXFxhcGlcXFxcZ2VuZXJhdGUtY2FsZW5kYXJcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlLWNhbGVuZGFyL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-calendar%2Froute&page=%2Fapi%2Fgenerate-calendar%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-calendar%2Froute.ts&appDir=C%3A%5CRepos%5Creddit_mastermind_assessment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5Creddit_mastermind_assessment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/generate-calendar/route.ts":
/*!********************************************!*\
  !*** ./app/api/generate-calendar/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration),\n/* harmony export */   runGeneration: () => (/* binding */ runGeneration)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n/* harmony import */ var _lib_personas__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/personas */ \"(rsc)/./lib/personas.ts\");\n/* harmony import */ var _lib_timestamps__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/timestamps */ \"(rsc)/./lib/timestamps.ts\");\n\n\n\n\n// Allow long-running generation (needed on serverless hosts)\nconst maxDuration = 60;\nconst PY_SERVICE = process.env.PYTHON_SERVICE_URL || \"http://localhost:8000\";\nfunction supabaseConfigured() {\n    return  true && \"https://pvrgybkyonzonmzryckv.supabase.co\" !== \"https://your-project.supabase.co\";\n}\nasync function callPython(path, payload) {\n    const controller = new AbortController();\n    // NOTE: Local Ollama generation can exceed 5 mins.\n    const timeout = setTimeout(()=>controller.abort(), 600000); // 10 minute timeout for long generations\n    const res = await fetch(`${PY_SERVICE}${path}`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(payload),\n        signal: controller.signal\n    }).catch((err)=>{\n        throw new Error(`Python service unreachable: ${err?.message || err}`);\n    }).finally(()=>clearTimeout(timeout));\n    if (!res.ok) {\n        const text = await res.text().catch(()=>\"\");\n        throw new Error(`Python service error ${res.status}: ${text}`);\n    }\n    return res.json();\n}\nasync function runGeneration(body) {\n    // Allow the client to provide overrides (personas, keywords, subreddit, posts_per_week)\n    const companyId = typeof body.company_id === \"string\" ? body.company_id : null;\n    if (!supabaseConfigured()) {\n        return {\n            ok: false,\n            error: \"supabase_required\",\n            details: \"Supabase must be configured to generate content.\"\n        };\n    }\n    // Load authoritative data from Supabase when configured, otherwise use provided/fallback data\n    let company = null;\n    let personas = [];\n    let keywords = [];\n    let fetchedSubreddit = null;\n    if (supabaseConfigured()) {\n        try {\n            const companyQuery = _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"company_details\").select(\"*\");\n            const { data: companyRow } = companyId ? await companyQuery.eq(\"company_id\", companyId).single() : await companyQuery.limit(1).single();\n            // fetch richer persona/keyword/subreddit data to map to DB IDs later\n            const companyFilterId = companyRow?.company_id || companyId;\n            const { data: personaRows } = companyFilterId ? await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"personas\").select(\"persona_username, persona_description, company_id\").eq(\"company_id\", companyFilterId) : {\n                data: []\n            };\n            const { data: keywordRows } = companyFilterId ? await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"chatgpt_queries\").select(\"keyword_id, keyword_phrase\").eq(\"company_id\", companyFilterId) : {\n                data: []\n            };\n            const { data: subredditRows } = companyFilterId ? await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"subreddits\").select(\"subreddit_id, subreddit_name, company_id\").eq(\"company_id\", companyFilterId) : {\n                data: []\n            };\n            company = companyRow || null;\n            personas = personaRows || [];\n            keywords = keywordRows || [];\n            if (subredditRows && subredditRows.length) {\n                const idx = Math.floor(Math.random() * subredditRows.length);\n                fetchedSubreddit = subredditRows[idx]?.subreddit_name || null;\n            }\n            // if company has a subreddit configured but it's not present in DB, leave company.subreddit as-is; we'll create it later\n            if (!company && companyRow) company = companyRow;\n        } catch (err) {\n            console.warn(\"Supabase fetch failed, falling back to request/defaults\", err);\n        }\n    }\n    // Client-provided overrides take precedence when Supabase isn't available\n    if (!company) {\n        if (body.company) {\n            company = body.company;\n        } else {\n            company = {\n                company_id: \"demo-company\",\n                company_name: \"DemoCorp\",\n                company_description: \"AI-powered slide tooling for marketers to plan Reddit content.\",\n                website_url: \"https://demo.example.com\",\n                subreddit: \"DemoTrials\",\n                posts_per_week: 3\n            };\n        }\n    }\n    if (!personas || personas.length === 0) {\n        personas = body.personas || [\n            {\n                persona_username: \"brandvoice\",\n                persona_description: \"Helpful marketer sharing slide tips\"\n            },\n            {\n                persona_username: \"curious_dev\",\n                persona_description: \"Curious engineer who builds side projects\"\n            },\n            {\n                persona_username: \"ops_guru\",\n                persona_description: \"Operations lead who loves efficiency hacks\"\n            }\n        ];\n    }\n    if (!keywords || keywords.length === 0) {\n        keywords = body.keywords || [\n            {\n                keyword_id: \"k1\",\n                keyword_phrase: \"content calendar\"\n            },\n            {\n                keyword_id: \"k2\",\n                keyword_phrase: \"reddit engagement\"\n            },\n            {\n                keyword_id: \"k3\",\n                keyword_phrase: \"slide deck tips\"\n            }\n        ];\n    }\n    // Prefer client override, then company.subreddit, then fetched subreddits from DB\n    const effectiveSubreddit = body.subreddit || fetchedSubreddit || company.subreddit || \"unknown\";\n    const postsPerWeek = body.posts_per_week || company.posts_per_week || 3;\n    // Request keyword scoring from Python service\n    let selectedKeywords = [];\n    try {\n        const keywordRes = await callPython(\"/generate/keywords\", {\n            company_description: company.company_description,\n            keywords,\n            posts_per_week: postsPerWeek\n        });\n        selectedKeywords = (keywordRes.selected || []).slice(0, postsPerWeek).map((k)=>({\n                keyword_id: k.keyword_id,\n                keyword_phrase: k.keyword_phrase\n            }));\n    } catch (err) {\n        console.error(\"Keyword scoring failed:\", err?.message || err);\n        return {\n            ok: false,\n            error: \"keyword_scoring_failed\",\n            details: String(err)\n        };\n    }\n    // Distribute personas across selected posts (ensures persona/day constraints via assignPersonasToPosts)\n    const assignments = (0,_lib_personas__WEBPACK_IMPORTED_MODULE_2__.assignPersonasToPosts)(personas, selectedKeywords.length);\n    // Reset mock storage only when using mock fallback\n    const createdPosts = [];\n    const createdComments = [];\n    // Track how many comments each persona has made to avoid over-commenting\n    const personaCommentCounts = {};\n    try {\n        for(let i = 0; i < selectedKeywords.length; i++){\n            const keyword = selectedKeywords[i];\n            const assignment = assignments[i];\n            const persona = assignment.persona;\n            // Generate post via Python\n            const postGen = await callPython(\"/generate/post\", {\n                subreddit: effectiveSubreddit,\n                keyword_phrase: keyword.keyword_phrase,\n                persona_description: persona.persona_description,\n                company_description: company.company_description\n            });\n            const postId = `P${createdPosts.length + 1}`;\n            const timestamp = (0,_lib_timestamps__WEBPACK_IMPORTED_MODULE_3__.iso)(assignment.date);\n            const postRow = {\n                post_id: postId,\n                subreddit: effectiveSubreddit,\n                persona_username: persona.persona_username,\n                title: (postGen.title || \"\").trim(),\n                body: (postGen.body || \"\").trim(),\n                timestamp,\n                keyword_ids: [\n                    keyword.keyword_id\n                ]\n            };\n            createdPosts.push(postRow);\n            // Generate between 1 and 3 comments from other personas\n            const minComments = 1;\n            const maxComments = 3;\n            const commentCount = Math.max(minComments, Math.min(maxComments, Math.round(1 + Math.random() * 2)));\n            const possibleCommenters = personas.filter((p)=>p.persona_username !== persona.persona_username);\n            // shuffle commenters to avoid repetition on a single post\n            const shuffledCommenters = [\n                ...possibleCommenters\n            ].sort(()=>Math.random() - 0.5);\n            let commenterIdx = 0;\n            let parentText = postRow.body;\n            let parentId = null;\n            for(let c = 0; c < commentCount; c++){\n                // Rotate through shuffled commenters to reduce repetition\n                const commenter = shuffledCommenters[commenterIdx % (shuffledCommenters.length || 1)] || personas.find((p)=>p.persona_username !== persona.persona_username) || personas[0];\n                commenterIdx += 1;\n                personaCommentCounts[commenter.persona_username] = (personaCommentCounts[commenter.persona_username] || 0) + 1;\n                // Generate comment via Python\n                const commentGen = await callPython(\"/generate/comment\", {\n                    persona_description: commenter.persona_description,\n                    parent_text: parentText,\n                    post_title: postRow.title,\n                    post_body: postRow.body,\n                    company_description: company.company_description\n                });\n                const commentId = `C${createdComments.length + 1}`;\n                const ts = parentId === null ? (0,_lib_timestamps__WEBPACK_IMPORTED_MODULE_3__.childTimestamp)(postRow.timestamp) : (0,_lib_timestamps__WEBPACK_IMPORTED_MODULE_3__.childTimestamp)(createdComments.find((cc)=>cc.comment_id === parentId).timestamp);\n                const commentRow = {\n                    comment_id: commentId,\n                    post_id: postId,\n                    parent_comment_id: parentId,\n                    persona_username: commenter.persona_username,\n                    comment_text: (commentGen.comment_text || \"\").trim(),\n                    timestamp: ts\n                };\n                createdComments.push(commentRow);\n                // Alternate replies to create simple threads; don't let the original persona reply to itself\n                if (c % 2 === 0) {\n                    parentId = commentId;\n                    parentText = commentRow.comment_text;\n                } else {\n                    parentId = null;\n                    parentText = postRow.body;\n                }\n            }\n        }\n    } catch (err) {\n        console.error(\"Generation failed:\", err);\n        return {\n            ok: false,\n            error: \"generation_failed\",\n            details: String(err)\n        };\n    }\n    // Persist to Supabase when available, otherwise keep in-memory mock\n    try {\n        // Build persona map from fetched personas\n        const personaMap = new Map();\n        if (personas && personas.length) personas.forEach((p)=>personaMap.set(p.persona_username, p));\n        // Upsert missing personas used in generation so we have persona rows keyed by username\n        const usedPersonas = Array.from(new Set(createdPosts.map((p)=>p.persona_username).concat(createdComments.map((c)=>c.persona_username))));\n        const missingPersonas = usedPersonas.filter((u)=>!personaMap.has(u));\n        if (missingPersonas.length) {\n            const toUpsert = missingPersonas.map((username)=>{\n                const proto = personas.find((p)=>p.persona_username === username) || {\n                    persona_description: \"\"\n                };\n                return {\n                    persona_username: username,\n                    persona_description: proto.persona_description || \"\",\n                    company_id: company?.company_id || null\n                };\n            });\n            const { data: upserted } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"personas\").upsert(toUpsert, {\n                onConflict: \"persona_username\"\n            }).select(\"persona_username, persona_description, company_id\");\n            if (upserted && upserted.length) upserted.forEach((p)=>personaMap.set(p.persona_username, p));\n        }\n        // Ensure subreddit exists for company; fetch and create if necessary\n        let subredditRow = null;\n        try {\n            const { data: srows } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"subreddits\").select(\"subreddit_id, subreddit_name, company_id\").eq(\"company_id\", company?.company_id || companyId || \"\");\n            if (srows && srows.length) subredditRow = srows.find((s)=>s.subreddit_name === effectiveSubreddit) || srows[0];\n            if (!subredditRow && effectiveSubreddit) {\n                const { data: created } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"subreddits\").insert([\n                    {\n                        subreddit_name: effectiveSubreddit,\n                        company_id: company?.company_id || null\n                    }\n                ]).select(\"subreddit_id, subreddit_name, company_id\");\n                if (created && created.length) subredditRow = created[0];\n            }\n        } catch (e) {\n        // ignore\n        }\n        // Build DB payload for posts (do not set post_id so DB will generate UUIDs)\n        const safeCompanyId = typeof company?.company_id === \"string\" ? company.company_id : null;\n        const dbPostsPayload = createdPosts.map((p)=>({\n                company_id: safeCompanyId,\n                subreddit_id: subredditRow ? subredditRow.subreddit_id : null,\n                persona_username: p.persona_username,\n                title: p.title,\n                body: p.body,\n                timestamp: p.timestamp,\n                keyword_ids: p.keyword_ids\n            }));\n        // Insert posts and retrieve generated post_ids\n        const { data: insertedPosts, error: postInsertError } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"calendar_posts\").insert(dbPostsPayload).select(\"post_id, title, timestamp, persona_username, subreddit_id\");\n        if (postInsertError) throw postInsertError;\n        // Map createdPosts index -> inserted post_id\n        const postIdMap = new Map();\n        (insertedPosts || []).forEach((row, idx)=>postIdMap.set(idx, row.post_id));\n        // Build comments payload for DB with mapped post_ids and persona_ids\n        const dbCommentsPayload = createdComments.map((c)=>{\n            const matchIndex = createdPosts.findIndex((pp)=>pp.post_id === c.post_id);\n            const mappedPostId = postIdMap.get(matchIndex) || null;\n            return {\n                post_id: mappedPostId,\n                parent_comment_id: null,\n                persona_username: c.persona_username,\n                comment_text: c.comment_text,\n                timestamp: c.timestamp\n            };\n        });\n        if (dbCommentsPayload.length) {\n            const { error: commentErr } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"calendar_comments\").insert(dbCommentsPayload);\n            if (commentErr) throw commentErr;\n        }\n    } catch (err) {\n        console.warn(\"Persisting to Supabase failed:\", err);\n        return {\n            ok: false,\n            error: \"persist_failed\",\n            details: String(err)\n        };\n    }\n    return {\n        ok: true,\n        posts: createdPosts,\n        comments: createdComments\n    };\n}\nasync function POST(req) {\n    const body = await req.json().catch(()=>({}));\n    const result = await runGeneration(body);\n    const status = result.ok ? 200 : 500;\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result, {\n        status\n    });\n}\nasync function GET() {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        ok: false,\n        error: \"use_generate_start\",\n        details: \"Call /api/generate/start to enqueue a job.\"\n    }, {\n        status: 400\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2dlbmVyYXRlLWNhbGVuZGFyL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQTJDO0FBQ0k7QUFDUTtBQUNBO0FBR3ZELDZEQUE2RDtBQUN0RCxNQUFNSyxjQUFjLEdBQUc7QUFhOUIsTUFBTUMsYUFBYUMsUUFBUUMsR0FBRyxDQUFDQyxrQkFBa0IsSUFBSTtBQUVyRCxTQUFTQztJQUNQLE9BQ0UsS0FBc0MsSUFDdENILDBDQUFvQyxLQUFLO0FBRTdDO0FBRUEsZUFBZUssV0FBY0MsSUFBWSxFQUFFQyxPQUFZO0lBQ3JELE1BQU1DLGFBQWEsSUFBSUM7SUFDdkIsbURBQW1EO0lBQ25ELE1BQU1DLFVBQVVDLFdBQVcsSUFBTUgsV0FBV0ksS0FBSyxJQUFJLFNBQVMseUNBQXlDO0lBQ3ZHLE1BQU1DLE1BQU0sTUFBTUMsTUFBTSxDQUFDLEVBQUVmLFdBQVcsRUFBRU8sS0FBSyxDQUFDLEVBQUU7UUFDOUNTLFFBQVE7UUFDUkMsU0FBUztZQUFFLGdCQUFnQjtRQUFtQjtRQUM5Q0MsTUFBTUMsS0FBS0MsU0FBUyxDQUFDWjtRQUNyQmEsUUFBUVosV0FBV1ksTUFBTTtJQUMzQixHQUFHQyxLQUFLLENBQUMsQ0FBQ0M7UUFDUixNQUFNLElBQUlDLE1BQU0sQ0FBQyw0QkFBNEIsRUFBRUQsS0FBS0UsV0FBV0YsSUFBSSxDQUFDO0lBQ3RFLEdBQUdHLE9BQU8sQ0FBQyxJQUFNQyxhQUFhaEI7SUFDOUIsSUFBSSxDQUFDRyxJQUFJYyxFQUFFLEVBQUU7UUFDWCxNQUFNQyxPQUFPLE1BQU1mLElBQUllLElBQUksR0FBR1AsS0FBSyxDQUFDLElBQU07UUFDMUMsTUFBTSxJQUFJRSxNQUFNLENBQUMscUJBQXFCLEVBQUVWLElBQUlnQixNQUFNLENBQUMsRUFBRSxFQUFFRCxLQUFLLENBQUM7SUFDL0Q7SUFDQSxPQUFPZixJQUFJaUIsSUFBSTtBQUNqQjtBQUVPLGVBQWVDLGNBQWNkLElBQVM7SUFDM0Msd0ZBQXdGO0lBQ3hGLE1BQU1l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O2dCQUNuQnpELGtCQUFrQjZDLEVBQUU3QyxnQkFBZ0I7Z0JBQ3BDMEQsY0FBY2IsRUFBRWEsWUFBWTtnQkFDNUJuQyxXQUFXc0IsRUFBRXRCLFNBQVM7WUFDeEI7UUFDRjtRQUVBLElBQUlrRSxrQkFBa0J0RyxNQUFNLEVBQUU7WUFDNUIsTUFBTSxFQUFFbEIsT0FBTzhILFVBQVUsRUFBRSxHQUFHLE1BQU10Syx3REFBYUEsQ0FBQytDLElBQUksQ0FBQyxxQkFBcUJ3RyxNQUFNLENBQUNTO1lBQ25GLElBQUlNLFlBQVksTUFBTUE7UUFDeEI7SUFDRixFQUFFLE9BQU8xSSxLQUFLO1FBQ1pvQyxRQUFRQyxJQUFJLENBQUMsa0NBQWtDckM7UUFDL0MsT0FBTztZQUFFSyxJQUFJO1lBQU9PLE9BQU87WUFBa0JDLFNBQVMwQyxPQUFPdkQ7UUFBSztJQUNwRTtJQUVBLE9BQU87UUFBRUssSUFBSTtRQUFNc0ksT0FBT2xGO1FBQWNtRixVQUFVbEY7SUFBZ0I7QUFDcEU7QUFFTyxlQUFlbUYsS0FBS0MsR0FBWTtJQUNyQyxNQUFNbkosT0FBTyxNQUFNbUosSUFBSXRJLElBQUksR0FBR1QsS0FBSyxDQUFDLElBQU8sRUFBQztJQUM1QyxNQUFNZ0osU0FBUyxNQUFNdEksY0FBY2Q7SUFDbkMsTUFBTVksU0FBU3dJLE9BQU8xSSxFQUFFLEdBQUcsTUFBTTtJQUNqQyxPQUFPbEMscURBQVlBLENBQUNxQyxJQUFJLENBQUN1SSxRQUFRO1FBQUV4STtJQUFPO0FBQzVDO0FBRU8sZUFBZXlJO0lBQ3BCLE9BQU83SyxxREFBWUEsQ0FBQ3FDLElBQUksQ0FBQztRQUFFSCxJQUFJO1FBQU9PLE9BQU87UUFBc0JDLFNBQVM7SUFBNkMsR0FBRztRQUFFTixRQUFRO0lBQUk7QUFDNUkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbGlkZWZvcmdlLXJlZGRpdC1jYWxlbmRhci8uL2FwcC9hcGkvZ2VuZXJhdGUtY2FsZW5kYXIvcm91dGUudHM/MTIzYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tIFwiQC9saWIvc3VwYWJhc2VcIjtcbmltcG9ydCB7IGFzc2lnblBlcnNvbmFzVG9Qb3N0cyB9IGZyb20gXCJAL2xpYi9wZXJzb25hc1wiO1xuaW1wb3J0IHsgY2hpbGRUaW1lc3RhbXAsIGlzbyB9IGZyb20gXCJAL2xpYi90aW1lc3RhbXBzXCI7XG5pbXBvcnQgeyBQb3N0Um93LCBDb21tZW50Um93IH0gZnJvbSBcIi4uL19kYXRhL21vY2tTdG9yZVwiO1xuXG4vLyBBbGxvdyBsb25nLXJ1bm5pbmcgZ2VuZXJhdGlvbiAobmVlZGVkIG9uIHNlcnZlcmxlc3MgaG9zdHMpXG5leHBvcnQgY29uc3QgbWF4RHVyYXRpb24gPSA2MDtcblxudHlwZSBQZXJzb25hUm93ID0geyBwZXJzb25hX3VzZXJuYW1lOiBzdHJpbmc7IHBlcnNvbmFfZGVzY3JpcHRpb246IHN0cmluZzsgY29tcGFueV9pZD86IHN0cmluZyB8IG51bGwgfTtcbnR5cGUgQ29tcGFueVJvdyA9IHtcbiAgY29tcGFueV9pZDogc3RyaW5nO1xuICBjb21wYW55X25hbWU6IHN0cmluZztcbiAgY29tcGFueV9kZXNjcmlwdGlvbjogc3RyaW5nO1xuICB3ZWJzaXRlX3VybDogc3RyaW5nO1xuICBzdWJyZWRkaXQ/OiBzdHJpbmc7XG4gIHBvc3RzX3Blcl93ZWVrOiBudW1iZXI7XG59O1xudHlwZSBLZXl3b3JkUm93ID0geyBrZXl3b3JkX2lkOiBzdHJpbmc7IGtleXdvcmRfcGhyYXNlOiBzdHJpbmcgfTtcblxuY29uc3QgUFlfU0VSVklDRSA9IHByb2Nlc3MuZW52LlBZVEhPTl9TRVJWSUNFX1VSTCB8fCBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMFwiO1xuXG5mdW5jdGlvbiBzdXBhYmFzZUNvbmZpZ3VyZWQoKSB7XG4gIHJldHVybiAoXG4gICAgISFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgJiZcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgIT09IFwiaHR0cHM6Ly95b3VyLXByb2plY3Quc3VwYWJhc2UuY29cIlxuICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjYWxsUHl0aG9uPFQ+KHBhdGg6IHN0cmluZywgcGF5bG9hZDogYW55KTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gIC8vIE5PVEU6IExvY2FsIE9sbGFtYSBnZW5lcmF0aW9uIGNhbiBleGNlZWQgNSBtaW5zLlxuICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIDYwMDAwMCk7IC8vIDEwIG1pbnV0ZSB0aW1lb3V0IGZvciBsb25nIGdlbmVyYXRpb25zXG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke1BZX1NFUlZJQ0V9JHtwYXRofWAsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSxcbiAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsXG4gIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFB5dGhvbiBzZXJ2aWNlIHVucmVhY2hhYmxlOiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCk7XG4gIH0pLmZpbmFsbHkoKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVvdXQpKTtcbiAgaWYgKCFyZXMub2spIHtcbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKS5jYXRjaCgoKSA9PiBcIlwiKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFB5dGhvbiBzZXJ2aWNlIGVycm9yICR7cmVzLnN0YXR1c306ICR7dGV4dH1gKTtcbiAgfVxuICByZXR1cm4gcmVzLmpzb24oKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1bkdlbmVyYXRpb24oYm9keTogYW55KSB7XG4gIC8vIEFsbG93IHRoZSBjbGllbnQgdG8gcHJvdmlkZSBvdmVycmlkZXMgKHBlcnNvbmFzLCBrZXl3b3Jkcywgc3VicmVkZGl0LCBwb3N0c19wZXJfd2VlaylcbiAgY29uc3QgY29tcGFueUlkOiBzdHJpbmcgfCBudWxsID0gdHlwZW9mIGJvZHkuY29tcGFueV9pZCA9PT0gXCJzdHJpbmdcIiA/IGJvZHkuY29tcGFueV9pZCA6IG51bGw7XG5cbiAgaWYgKCFzdXBhYmFzZUNvbmZpZ3VyZWQoKSkge1xuICAgIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6IFwic3VwYWJhc2VfcmVxdWlyZWRcIiwgZGV0YWlsczogXCJTdXBhYmFzZSBtdXN0IGJlIGNvbmZpZ3VyZWQgdG8gZ2VuZXJhdGUgY29udGVudC5cIiB9O1xuICB9XG5cbiAgLy8gTG9hZCBhdXRob3JpdGF0aXZlIGRhdGEgZnJvbSBTdXBhYmFzZSB3aGVuIGNvbmZpZ3VyZWQsIG90aGVyd2lzZSB1c2UgcHJvdmlkZWQvZmFsbGJhY2sgZGF0YVxuICBsZXQgY29tcGFueTogQ29tcGFueVJvdyB8IG51bGwgPSBudWxsO1xuICBsZXQgcGVyc29uYXM6IFBlcnNvbmFSb3dbXSA9IFtdO1xuICBsZXQga2V5d29yZHM6IEtleXdvcmRSb3dbXSA9IFtdO1xuICBsZXQgZmV0Y2hlZFN1YnJlZGRpdDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgaWYgKHN1cGFiYXNlQ29uZmlndXJlZCgpKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbXBhbnlRdWVyeSA9IHN1cGFiYXNlQWRtaW4uZnJvbShcImNvbXBhbnlfZGV0YWlsc1wiKS5zZWxlY3QoXCIqXCIpO1xuICAgICAgY29uc3QgeyBkYXRhOiBjb21wYW55Um93IH0gPSBjb21wYW55SWRcbiAgICAgICAgPyBhd2FpdCBjb21wYW55UXVlcnkuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlJZCkuc2luZ2xlKClcbiAgICAgICAgOiBhd2FpdCBjb21wYW55UXVlcnkubGltaXQoMSkuc2luZ2xlKCk7XG5cbiAgICAgIC8vIGZldGNoIHJpY2hlciBwZXJzb25hL2tleXdvcmQvc3VicmVkZGl0IGRhdGEgdG8gbWFwIHRvIERCIElEcyBsYXRlclxuICAgICAgY29uc3QgY29tcGFueUZpbHRlcklkID0gY29tcGFueVJvdz8uY29tcGFueV9pZCB8fCBjb21wYW55SWQ7XG5cbiAgICAgIGNvbnN0IHsgZGF0YTogcGVyc29uYVJvd3MgfSA9IGNvbXBhbnlGaWx0ZXJJZFxuICAgICAgICA/IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAgIC5mcm9tKFwicGVyc29uYXNcIilcbiAgICAgICAgICAgIC5zZWxlY3QoXCJwZXJzb25hX3VzZXJuYW1lLCBwZXJzb25hX2Rlc2NyaXB0aW9uLCBjb21wYW55X2lkXCIpXG4gICAgICAgICAgICAuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlGaWx0ZXJJZClcbiAgICAgICAgOiB7IGRhdGE6IFtdIH07XG4gICAgICBjb25zdCB7IGRhdGE6IGtleXdvcmRSb3dzIH0gPSBjb21wYW55RmlsdGVySWRcbiAgICAgICAgPyBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgICAgICAuZnJvbShcImNoYXRncHRfcXVlcmllc1wiKVxuICAgICAgICAgICAgLnNlbGVjdChcImtleXdvcmRfaWQsIGtleXdvcmRfcGhyYXNlXCIpXG4gICAgICAgICAgICAuZXEoXCJjb21wYW55X2lkXCIsIGNvbXBhbnlGaWx0ZXJJZClcbiAgICAgICAgOiB7IGRhdGE6IFtdIH07XG4gICAgICBjb25zdCB7IGRhdGE6IHN1YnJlZGRpdFJvd3MgfSA9IGNvbXBhbnlGaWx0ZXJJZFxuICAgICAgICA/IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAgIC5mcm9tKFwic3VicmVkZGl0c1wiKVxuICAgICAgICAgICAgLnNlbGVjdChcInN1YnJlZGRpdF9pZCwgc3VicmVkZGl0X25hbWUsIGNvbXBhbnlfaWRcIilcbiAgICAgICAgICAgIC5lcShcImNvbXBhbnlfaWRcIiwgY29tcGFueUZpbHRlcklkKVxuICAgICAgICA6IHsgZGF0YTogW10gfTtcblxuICAgICAgY29tcGFueSA9IGNvbXBhbnlSb3cgfHwgbnVsbDtcbiAgICAgIHBlcnNvbmFzID0gKHBlcnNvbmFSb3dzIGFzIGFueSkgfHwgW107XG4gICAgICBrZXl3b3JkcyA9IChrZXl3b3JkUm93cyBhcyBhbnkpIHx8IFtdO1xuICAgICAgaWYgKHN1YnJlZGRpdFJvd3MgJiYgc3VicmVkZGl0Um93cy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3VicmVkZGl0Um93cy5sZW5ndGgpO1xuICAgICAgICBmZXRjaGVkU3VicmVkZGl0ID0gKHN1YnJlZGRpdFJvd3NbaWR4XT8uc3VicmVkZGl0X25hbWUgYXMgc3RyaW5nKSB8fCBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBpZiBjb21wYW55IGhhcyBhIHN1YnJlZGRpdCBjb25maWd1cmVkIGJ1dCBpdCdzIG5vdCBwcmVzZW50IGluIERCLCBsZWF2ZSBjb21wYW55LnN1YnJlZGRpdCBhcy1pczsgd2UnbGwgY3JlYXRlIGl0IGxhdGVyXG4gICAgICBpZiAoIWNvbXBhbnkgJiYgY29tcGFueVJvdykgY29tcGFueSA9IGNvbXBhbnlSb3c7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJTdXBhYmFzZSBmZXRjaCBmYWlsZWQsIGZhbGxpbmcgYmFjayB0byByZXF1ZXN0L2RlZmF1bHRzXCIsIGVycik7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2xpZW50LXByb3ZpZGVkIG92ZXJyaWRlcyB0YWtlIHByZWNlZGVuY2Ugd2hlbiBTdXBhYmFzZSBpc24ndCBhdmFpbGFibGVcbiAgaWYgKCFjb21wYW55KSB7XG4gICAgaWYgKGJvZHkuY29tcGFueSkge1xuICAgICAgY29tcGFueSA9IGJvZHkuY29tcGFueSBhcyBDb21wYW55Um93O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb21wYW55ID0ge1xuICAgICAgICBjb21wYW55X2lkOiBcImRlbW8tY29tcGFueVwiLFxuICAgICAgICBjb21wYW55X25hbWU6IFwiRGVtb0NvcnBcIixcbiAgICAgICAgY29tcGFueV9kZXNjcmlwdGlvbjogXCJBSS1wb3dlcmVkIHNsaWRlIHRvb2xpbmcgZm9yIG1hcmtldGVycyB0byBwbGFuIFJlZGRpdCBjb250ZW50LlwiLFxuICAgICAgICB3ZWJzaXRlX3VybDogXCJodHRwczovL2RlbW8uZXhhbXBsZS5jb21cIixcbiAgICAgICAgc3VicmVkZGl0OiBcIkRlbW9UcmlhbHNcIixcbiAgICAgICAgcG9zdHNfcGVyX3dlZWs6IDNcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgaWYgKCFwZXJzb25hcyB8fCBwZXJzb25hcy5sZW5ndGggPT09IDApIHtcbiAgICBwZXJzb25hcyA9IChib2R5LnBlcnNvbmFzIGFzIFBlcnNvbmFSb3dbXSkgfHwgW1xuICAgICAgeyBwZXJzb25hX3VzZXJuYW1lOiBcImJyYW5kdm9pY2VcIiwgcGVyc29uYV9kZXNjcmlwdGlvbjogXCJIZWxwZnVsIG1hcmtldGVyIHNoYXJpbmcgc2xpZGUgdGlwc1wiIH0sXG4gICAgICB7IHBlcnNvbmFfdXNlcm5hbWU6IFwiY3VyaW91c19kZXZcIiwgcGVyc29uYV9kZXNjcmlwdGlvbjogXCJDdXJpb3VzIGVuZ2luZWVyIHdobyBidWlsZHMgc2lkZSBwcm9qZWN0c1wiIH0sXG4gICAgICB7IHBlcnNvbmFfdXNlcm5hbWU6IFwib3BzX2d1cnVcIiwgcGVyc29uYV9kZXNjcmlwdGlvbjogXCJPcGVyYXRpb25zIGxlYWQgd2hvIGxvdmVzIGVmZmljaWVuY3kgaGFja3NcIiB9XG4gICAgXTtcbiAgfVxuXG4gIGlmICgha2V5d29yZHMgfHwga2V5d29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAga2V5d29yZHMgPSAoYm9keS5rZXl3b3JkcyBhcyBLZXl3b3JkUm93W10pIHx8IFtcbiAgICAgIHsga2V5d29yZF9pZDogXCJrMVwiLCBrZXl3b3JkX3BocmFzZTogXCJjb250ZW50IGNhbGVuZGFyXCIgfSxcbiAgICAgIHsga2V5d29yZF9pZDogXCJrMlwiLCBrZXl3b3JkX3BocmFzZTogXCJyZWRkaXQgZW5nYWdlbWVudFwiIH0sXG4gICAgICB7IGtleXdvcmRfaWQ6IFwiazNcIiwga2V5d29yZF9waHJhc2U6IFwic2xpZGUgZGVjayB0aXBzXCIgfVxuICAgIF07XG4gIH1cblxuICAvLyBQcmVmZXIgY2xpZW50IG92ZXJyaWRlLCB0aGVuIGNvbXBhbnkuc3VicmVkZGl0LCB0aGVuIGZldGNoZWQgc3VicmVkZGl0cyBmcm9tIERCXG4gIGNvbnN0IGVmZmVjdGl2ZVN1YnJlZGRpdDogc3RyaW5nID1cbiAgICAoYm9keS5zdWJyZWRkaXQgYXMgc3RyaW5nKSB8fFxuICAgIGZldGNoZWRTdWJyZWRkaXQgfHxcbiAgICBjb21wYW55LnN1YnJlZGRpdCB8fFxuICAgIFwidW5rbm93blwiO1xuXG4gIGNvbnN0IHBvc3RzUGVyV2VlayA9IGJvZHkucG9zdHNfcGVyX3dlZWsgfHwgY29tcGFueS5wb3N0c19wZXJfd2VlayB8fCAzO1xuXG4gIC8vIFJlcXVlc3Qga2V5d29yZCBzY29yaW5nIGZyb20gUHl0aG9uIHNlcnZpY2VcbiAgbGV0IHNlbGVjdGVkS2V5d29yZHM6IHsga2V5d29yZF9pZDogc3RyaW5nOyBrZXl3b3JkX3BocmFzZTogc3RyaW5nIH1bXSA9IFtdO1xuICB0cnkge1xuICAgIGNvbnN0IGtleXdvcmRSZXMgPSBhd2FpdCBjYWxsUHl0aG9uPHsgc2VsZWN0ZWQ6IHsga2V5d29yZF9pZDogc3RyaW5nOyBzY29yZTogbnVtYmVyOyBrZXl3b3JkX3BocmFzZTogc3RyaW5nIH1bXSB9PihcbiAgICAgIFwiL2dlbmVyYXRlL2tleXdvcmRzXCIsXG4gICAgICB7XG4gICAgICAgIGNvbXBhbnlfZGVzY3JpcHRpb246IGNvbXBhbnkuY29tcGFueV9kZXNjcmlwdGlvbixcbiAgICAgICAga2V5d29yZHMsXG4gICAgICAgIHBvc3RzX3Blcl93ZWVrOiBwb3N0c1BlcldlZWtcbiAgICAgIH1cbiAgICApO1xuICAgIHNlbGVjdGVkS2V5d29yZHMgPSAoa2V5d29yZFJlcy5zZWxlY3RlZCB8fCBbXSkuc2xpY2UoMCwgcG9zdHNQZXJXZWVrKS5tYXAoKGspID0+ICh7IGtleXdvcmRfaWQ6IGsua2V5d29yZF9pZCwga2V5d29yZF9waHJhc2U6IGsua2V5d29yZF9waHJhc2UgfSkpO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJLZXl3b3JkIHNjb3JpbmcgZmFpbGVkOlwiLCBlcnI/Lm1lc3NhZ2UgfHwgZXJyKTtcbiAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBcImtleXdvcmRfc2NvcmluZ19mYWlsZWRcIiwgZGV0YWlsczogU3RyaW5nKGVycikgfTtcbiAgfVxuXG4gIC8vIERpc3RyaWJ1dGUgcGVyc29uYXMgYWNyb3NzIHNlbGVjdGVkIHBvc3RzIChlbnN1cmVzIHBlcnNvbmEvZGF5IGNvbnN0cmFpbnRzIHZpYSBhc3NpZ25QZXJzb25hc1RvUG9zdHMpXG4gIGNvbnN0IGFzc2lnbm1lbnRzID0gYXNzaWduUGVyc29uYXNUb1Bvc3RzKHBlcnNvbmFzLCBzZWxlY3RlZEtleXdvcmRzLmxlbmd0aCk7XG5cbiAgLy8gUmVzZXQgbW9jayBzdG9yYWdlIG9ubHkgd2hlbiB1c2luZyBtb2NrIGZhbGxiYWNrXG4gIGNvbnN0IGNyZWF0ZWRQb3N0czogUG9zdFJvd1tdID0gW107XG4gIGNvbnN0IGNyZWF0ZWRDb21tZW50czogQ29tbWVudFJvd1tdID0gW107XG5cbiAgLy8gVHJhY2sgaG93IG1hbnkgY29tbWVudHMgZWFjaCBwZXJzb25hIGhhcyBtYWRlIHRvIGF2b2lkIG92ZXItY29tbWVudGluZ1xuICBjb25zdCBwZXJzb25hQ29tbWVudENvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuXG4gIHRyeSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZEtleXdvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBrZXl3b3JkID0gc2VsZWN0ZWRLZXl3b3Jkc1tpXTtcbiAgICAgIGNvbnN0IGFzc2lnbm1lbnQgPSBhc3NpZ25tZW50c1tpXTtcbiAgICAgIGNvbnN0IHBlcnNvbmEgPSBhc3NpZ25tZW50LnBlcnNvbmE7XG5cbiAgICAgIC8vIEdlbmVyYXRlIHBvc3QgdmlhIFB5dGhvblxuICAgICAgY29uc3QgcG9zdEdlbiA9IGF3YWl0IGNhbGxQeXRob248eyB0aXRsZTogc3RyaW5nOyBib2R5OiBzdHJpbmcgfT4oXG4gICAgICAgIFwiL2dlbmVyYXRlL3Bvc3RcIixcbiAgICAgICAge1xuICAgICAgICAgIHN1YnJlZGRpdDogZWZmZWN0aXZlU3VicmVkZGl0LFxuICAgICAgICAgIGtleXdvcmRfcGhyYXNlOiBrZXl3b3JkLmtleXdvcmRfcGhyYXNlLFxuICAgICAgICAgIHBlcnNvbmFfZGVzY3JpcHRpb246IHBlcnNvbmEucGVyc29uYV9kZXNjcmlwdGlvbixcbiAgICAgICAgICBjb21wYW55X2Rlc2NyaXB0aW9uOiBjb21wYW55LmNvbXBhbnlfZGVzY3JpcHRpb25cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgcG9zdElkID0gYFAke2NyZWF0ZWRQb3N0cy5sZW5ndGggKyAxfWA7XG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBpc28oYXNzaWdubWVudC5kYXRlKTtcblxuICAgICAgY29uc3QgcG9zdFJvdzogUG9zdFJvdyA9IHtcbiAgICAgICAgcG9zdF9pZDogcG9zdElkLFxuICAgICAgICBzdWJyZWRkaXQ6IGVmZmVjdGl2ZVN1YnJlZGRpdCxcbiAgICAgICAgcGVyc29uYV91c2VybmFtZTogcGVyc29uYS5wZXJzb25hX3VzZXJuYW1lLFxuICAgICAgICB0aXRsZTogKHBvc3RHZW4udGl0bGUgfHwgXCJcIikudHJpbSgpLFxuICAgICAgICBib2R5OiAocG9zdEdlbi5ib2R5IHx8IFwiXCIpLnRyaW0oKSxcbiAgICAgICAgdGltZXN0YW1wLFxuICAgICAgICBrZXl3b3JkX2lkczogW2tleXdvcmQua2V5d29yZF9pZF1cbiAgICAgIH07XG5cbiAgICAgIGNyZWF0ZWRQb3N0cy5wdXNoKHBvc3RSb3cpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSBiZXR3ZWVuIDEgYW5kIDMgY29tbWVudHMgZnJvbSBvdGhlciBwZXJzb25hc1xuICAgICAgY29uc3QgbWluQ29tbWVudHMgPSAxO1xuICAgICAgY29uc3QgbWF4Q29tbWVudHMgPSAzO1xuICAgICAgY29uc3QgY29tbWVudENvdW50ID0gTWF0aC5tYXgobWluQ29tbWVudHMsIE1hdGgubWluKG1heENvbW1lbnRzLCBNYXRoLnJvdW5kKDEgKyBNYXRoLnJhbmRvbSgpICogMikpKTtcblxuICAgICAgY29uc3QgcG9zc2libGVDb21tZW50ZXJzID0gcGVyc29uYXMuZmlsdGVyKChwKSA9PiBwLnBlcnNvbmFfdXNlcm5hbWUgIT09IHBlcnNvbmEucGVyc29uYV91c2VybmFtZSk7XG4gICAgICAvLyBzaHVmZmxlIGNvbW1lbnRlcnMgdG8gYXZvaWQgcmVwZXRpdGlvbiBvbiBhIHNpbmdsZSBwb3N0XG4gICAgICBjb25zdCBzaHVmZmxlZENvbW1lbnRlcnMgPSBbLi4ucG9zc2libGVDb21tZW50ZXJzXS5zb3J0KCgpID0+IE1hdGgucmFuZG9tKCkgLSAwLjUpO1xuICAgICAgbGV0IGNvbW1lbnRlcklkeCA9IDA7XG5cbiAgICAgIGxldCBwYXJlbnRUZXh0ID0gcG9zdFJvdy5ib2R5O1xuICAgICAgbGV0IHBhcmVudElkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjb21tZW50Q291bnQ7IGMrKykge1xuICAgICAgICAvLyBSb3RhdGUgdGhyb3VnaCBzaHVmZmxlZCBjb21tZW50ZXJzIHRvIHJlZHVjZSByZXBldGl0aW9uXG4gICAgICAgIGNvbnN0IGNvbW1lbnRlciA9XG4gICAgICAgICAgc2h1ZmZsZWRDb21tZW50ZXJzW2NvbW1lbnRlcklkeCAlIChzaHVmZmxlZENvbW1lbnRlcnMubGVuZ3RoIHx8IDEpXSB8fFxuICAgICAgICAgIHBlcnNvbmFzLmZpbmQoKHApID0+IHAucGVyc29uYV91c2VybmFtZSAhPT0gcGVyc29uYS5wZXJzb25hX3VzZXJuYW1lKSB8fFxuICAgICAgICAgIHBlcnNvbmFzWzBdO1xuICAgICAgICBjb21tZW50ZXJJZHggKz0gMTtcblxuICAgICAgICBwZXJzb25hQ29tbWVudENvdW50c1tjb21tZW50ZXIucGVyc29uYV91c2VybmFtZV0gPSAocGVyc29uYUNvbW1lbnRDb3VudHNbY29tbWVudGVyLnBlcnNvbmFfdXNlcm5hbWVdIHx8IDApICsgMTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBjb21tZW50IHZpYSBQeXRob25cbiAgICAgICAgY29uc3QgY29tbWVudEdlbiA9IGF3YWl0IGNhbGxQeXRob248eyBjb21tZW50X3RleHQ6IHN0cmluZyB9PihcbiAgICAgICAgICBcIi9nZW5lcmF0ZS9jb21tZW50XCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgcGVyc29uYV9kZXNjcmlwdGlvbjogY29tbWVudGVyLnBlcnNvbmFfZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBwYXJlbnRfdGV4dDogcGFyZW50VGV4dCxcbiAgICAgICAgICAgIHBvc3RfdGl0bGU6IHBvc3RSb3cudGl0bGUsXG4gICAgICAgICAgICBwb3N0X2JvZHk6IHBvc3RSb3cuYm9keSxcbiAgICAgICAgICAgIGNvbXBhbnlfZGVzY3JpcHRpb246IGNvbXBhbnkuY29tcGFueV9kZXNjcmlwdGlvblxuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBjb21tZW50SWQgPSBgQyR7Y3JlYXRlZENvbW1lbnRzLmxlbmd0aCArIDF9YDtcbiAgICAgICAgY29uc3QgdHMgPSBwYXJlbnRJZCA9PT0gbnVsbCA/IGNoaWxkVGltZXN0YW1wKHBvc3RSb3cudGltZXN0YW1wKSA6IGNoaWxkVGltZXN0YW1wKGNyZWF0ZWRDb21tZW50cy5maW5kKChjYykgPT4gY2MuY29tbWVudF9pZCA9PT0gcGFyZW50SWQpIS50aW1lc3RhbXApO1xuXG4gICAgICAgIGNvbnN0IGNvbW1lbnRSb3c6IENvbW1lbnRSb3cgPSB7XG4gICAgICAgICAgY29tbWVudF9pZDogY29tbWVudElkLFxuICAgICAgICAgIHBvc3RfaWQ6IHBvc3RJZCxcbiAgICAgICAgICBwYXJlbnRfY29tbWVudF9pZDogcGFyZW50SWQsXG4gICAgICAgICAgcGVyc29uYV91c2VybmFtZTogY29tbWVudGVyLnBlcnNvbmFfdXNlcm5hbWUsXG4gICAgICAgICAgY29tbWVudF90ZXh0OiAoY29tbWVudEdlbi5jb21tZW50X3RleHQgfHwgXCJcIikudHJpbSgpLFxuICAgICAgICAgIHRpbWVzdGFtcDogdHNcbiAgICAgICAgfTtcblxuICAgICAgICBjcmVhdGVkQ29tbWVudHMucHVzaChjb21tZW50Um93KTtcblxuICAgICAgICAvLyBBbHRlcm5hdGUgcmVwbGllcyB0byBjcmVhdGUgc2ltcGxlIHRocmVhZHM7IGRvbid0IGxldCB0aGUgb3JpZ2luYWwgcGVyc29uYSByZXBseSB0byBpdHNlbGZcbiAgICAgICAgaWYgKGMgJSAyID09PSAwKSB7XG4gICAgICAgICAgcGFyZW50SWQgPSBjb21tZW50SWQ7XG4gICAgICAgICAgcGFyZW50VGV4dCA9IGNvbW1lbnRSb3cuY29tbWVudF90ZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhcmVudElkID0gbnVsbDtcbiAgICAgICAgICBwYXJlbnRUZXh0ID0gcG9zdFJvdy5ib2R5O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiR2VuZXJhdGlvbiBmYWlsZWQ6XCIsIGVycik7XG4gICAgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogXCJnZW5lcmF0aW9uX2ZhaWxlZFwiLCBkZXRhaWxzOiBTdHJpbmcoZXJyKSB9O1xuICB9XG5cbiAgLy8gUGVyc2lzdCB0byBTdXBhYmFzZSB3aGVuIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGtlZXAgaW4tbWVtb3J5IG1vY2tcbiAgdHJ5IHtcbiAgICAvLyBCdWlsZCBwZXJzb25hIG1hcCBmcm9tIGZldGNoZWQgcGVyc29uYXNcbiAgICBjb25zdCBwZXJzb25hTWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICBpZiAocGVyc29uYXMgJiYgcGVyc29uYXMubGVuZ3RoKSAocGVyc29uYXMgYXMgYW55W10pLmZvckVhY2goKHApID0+IHBlcnNvbmFNYXAuc2V0KHAucGVyc29uYV91c2VybmFtZSwgcCkpO1xuXG4gICAgLy8gVXBzZXJ0IG1pc3NpbmcgcGVyc29uYXMgdXNlZCBpbiBnZW5lcmF0aW9uIHNvIHdlIGhhdmUgcGVyc29uYSByb3dzIGtleWVkIGJ5IHVzZXJuYW1lXG4gICAgY29uc3QgdXNlZFBlcnNvbmFzID0gQXJyYXkuZnJvbShuZXcgU2V0KGNyZWF0ZWRQb3N0cy5tYXAoKHApID0+IHAucGVyc29uYV91c2VybmFtZSkuY29uY2F0KGNyZWF0ZWRDb21tZW50cy5tYXAoKGMpID0+IGMucGVyc29uYV91c2VybmFtZSkpKSk7XG4gICAgY29uc3QgbWlzc2luZ1BlcnNvbmFzID0gdXNlZFBlcnNvbmFzLmZpbHRlcigodSkgPT4gIXBlcnNvbmFNYXAuaGFzKHUpKTtcbiAgICBpZiAobWlzc2luZ1BlcnNvbmFzLmxlbmd0aCkge1xuICAgICAgY29uc3QgdG9VcHNlcnQgPSBtaXNzaW5nUGVyc29uYXMubWFwKCh1c2VybmFtZSkgPT4ge1xuICAgICAgICBjb25zdCBwcm90byA9IChwZXJzb25hcyBhcyBhbnlbXSkuZmluZCgocCkgPT4gcC5wZXJzb25hX3VzZXJuYW1lID09PSB1c2VybmFtZSkgfHwgeyBwZXJzb25hX2Rlc2NyaXB0aW9uOiBcIlwiIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcGVyc29uYV91c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgcGVyc29uYV9kZXNjcmlwdGlvbjogcHJvdG8ucGVyc29uYV9kZXNjcmlwdGlvbiB8fCBcIlwiLFxuICAgICAgICAgIGNvbXBhbnlfaWQ6IChjb21wYW55IGFzIGFueSk/LmNvbXBhbnlfaWQgfHwgbnVsbFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICBjb25zdCB7IGRhdGE6IHVwc2VydGVkIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgIC5mcm9tKFwicGVyc29uYXNcIilcbiAgICAgICAgLnVwc2VydCh0b1Vwc2VydCwgeyBvbkNvbmZsaWN0OiBcInBlcnNvbmFfdXNlcm5hbWVcIiB9KVxuICAgICAgICAuc2VsZWN0KFwicGVyc29uYV91c2VybmFtZSwgcGVyc29uYV9kZXNjcmlwdGlvbiwgY29tcGFueV9pZFwiKTtcbiAgICAgIGlmICh1cHNlcnRlZCAmJiB1cHNlcnRlZC5sZW5ndGgpIHVwc2VydGVkLmZvckVhY2goKHA6IGFueSkgPT4gcGVyc29uYU1hcC5zZXQocC5wZXJzb25hX3VzZXJuYW1lLCBwKSk7XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIHN1YnJlZGRpdCBleGlzdHMgZm9yIGNvbXBhbnk7IGZldGNoIGFuZCBjcmVhdGUgaWYgbmVjZXNzYXJ5XG4gICAgbGV0IHN1YnJlZGRpdFJvdzogYW55IHwgbnVsbCA9IG51bGw7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YTogc3Jvd3MgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oXCJzdWJyZWRkaXRzXCIpXG4gICAgICAgIC5zZWxlY3QoXCJzdWJyZWRkaXRfaWQsIHN1YnJlZGRpdF9uYW1lLCBjb21wYW55X2lkXCIpXG4gICAgICAgIC5lcShcImNvbXBhbnlfaWRcIiwgKGNvbXBhbnkgYXMgYW55KT8uY29tcGFueV9pZCB8fCBjb21wYW55SWQgfHwgXCJcIik7XG4gICAgICBpZiAoc3Jvd3MgJiYgc3Jvd3MubGVuZ3RoKSBzdWJyZWRkaXRSb3cgPSBzcm93cy5maW5kKChzOiBhbnkpID0+IHMuc3VicmVkZGl0X25hbWUgPT09IGVmZmVjdGl2ZVN1YnJlZGRpdCkgfHwgc3Jvd3NbMF07XG5cbiAgICAgIGlmICghc3VicmVkZGl0Um93ICYmIGVmZmVjdGl2ZVN1YnJlZGRpdCkge1xuICAgICAgICBjb25zdCB7IGRhdGE6IGNyZWF0ZWQgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAuZnJvbShcInN1YnJlZGRpdHNcIilcbiAgICAgICAgICAuaW5zZXJ0KFt7IHN1YnJlZGRpdF9uYW1lOiBlZmZlY3RpdmVTdWJyZWRkaXQsIGNvbXBhbnlfaWQ6IChjb21wYW55IGFzIGFueSk/LmNvbXBhbnlfaWQgfHwgbnVsbCB9XSlcbiAgICAgICAgICAuc2VsZWN0KFwic3VicmVkZGl0X2lkLCBzdWJyZWRkaXRfbmFtZSwgY29tcGFueV9pZFwiKTtcbiAgICAgICAgaWYgKGNyZWF0ZWQgJiYgY3JlYXRlZC5sZW5ndGgpIHN1YnJlZGRpdFJvdyA9IGNyZWF0ZWRbMF07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gaWdub3JlXG4gICAgfVxuXG4gICAgLy8gQnVpbGQgREIgcGF5bG9hZCBmb3IgcG9zdHMgKGRvIG5vdCBzZXQgcG9zdF9pZCBzbyBEQiB3aWxsIGdlbmVyYXRlIFVVSURzKVxuICAgIGNvbnN0IHNhZmVDb21wYW55SWQgPSB0eXBlb2YgKGNvbXBhbnkgYXMgYW55KT8uY29tcGFueV9pZCA9PT0gXCJzdHJpbmdcIiA/IChjb21wYW55IGFzIGFueSkuY29tcGFueV9pZCA6IG51bGw7XG5cbiAgICBjb25zdCBkYlBvc3RzUGF5bG9hZCA9IGNyZWF0ZWRQb3N0cy5tYXAoKHApID0+ICh7XG4gICAgICBjb21wYW55X2lkOiBzYWZlQ29tcGFueUlkLFxuICAgICAgc3VicmVkZGl0X2lkOiBzdWJyZWRkaXRSb3cgPyBzdWJyZWRkaXRSb3cuc3VicmVkZGl0X2lkIDogbnVsbCxcbiAgICAgIHBlcnNvbmFfdXNlcm5hbWU6IHAucGVyc29uYV91c2VybmFtZSxcbiAgICAgIHRpdGxlOiBwLnRpdGxlLFxuICAgICAgYm9keTogcC5ib2R5LFxuICAgICAgdGltZXN0YW1wOiBwLnRpbWVzdGFtcCxcbiAgICAgIGtleXdvcmRfaWRzOiBwLmtleXdvcmRfaWRzXG4gICAgfSkpO1xuXG4gICAgLy8gSW5zZXJ0IHBvc3RzIGFuZCByZXRyaWV2ZSBnZW5lcmF0ZWQgcG9zdF9pZHNcbiAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkUG9zdHMsIGVycm9yOiBwb3N0SW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKFwiY2FsZW5kYXJfcG9zdHNcIilcbiAgICAgIC5pbnNlcnQoZGJQb3N0c1BheWxvYWQpXG4gICAgICAuc2VsZWN0KFwicG9zdF9pZCwgdGl0bGUsIHRpbWVzdGFtcCwgcGVyc29uYV91c2VybmFtZSwgc3VicmVkZGl0X2lkXCIpO1xuICAgIGlmIChwb3N0SW5zZXJ0RXJyb3IpIHRocm93IHBvc3RJbnNlcnRFcnJvcjtcblxuICAgIC8vIE1hcCBjcmVhdGVkUG9zdHMgaW5kZXggLT4gaW5zZXJ0ZWQgcG9zdF9pZFxuICAgIGNvbnN0IHBvc3RJZE1hcCA9IG5ldyBNYXA8bnVtYmVyLCBzdHJpbmc+KCk7XG4gICAgKGluc2VydGVkUG9zdHMgfHwgW10pLmZvckVhY2goKHJvdzogYW55LCBpZHg6IG51bWJlcikgPT4gcG9zdElkTWFwLnNldChpZHgsIHJvdy5wb3N0X2lkKSk7XG5cbiAgICAvLyBCdWlsZCBjb21tZW50cyBwYXlsb2FkIGZvciBEQiB3aXRoIG1hcHBlZCBwb3N0X2lkcyBhbmQgcGVyc29uYV9pZHNcbiAgICBjb25zdCBkYkNvbW1lbnRzUGF5bG9hZDogYW55W10gPSBjcmVhdGVkQ29tbWVudHMubWFwKChjKSA9PiB7XG4gICAgICBjb25zdCBtYXRjaEluZGV4ID0gY3JlYXRlZFBvc3RzLmZpbmRJbmRleCgocHApID0+IHBwLnBvc3RfaWQgPT09IGMucG9zdF9pZCk7XG4gICAgICBjb25zdCBtYXBwZWRQb3N0SWQgPSBwb3N0SWRNYXAuZ2V0KG1hdGNoSW5kZXgpIHx8IG51bGw7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3N0X2lkOiBtYXBwZWRQb3N0SWQsXG4gICAgICAgIHBhcmVudF9jb21tZW50X2lkOiBudWxsLFxuICAgICAgICBwZXJzb25hX3VzZXJuYW1lOiBjLnBlcnNvbmFfdXNlcm5hbWUsXG4gICAgICAgIGNvbW1lbnRfdGV4dDogYy5jb21tZW50X3RleHQsXG4gICAgICAgIHRpbWVzdGFtcDogYy50aW1lc3RhbXBcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICBpZiAoZGJDb21tZW50c1BheWxvYWQubGVuZ3RoKSB7XG4gICAgICBjb25zdCB7IGVycm9yOiBjb21tZW50RXJyIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmZyb20oXCJjYWxlbmRhcl9jb21tZW50c1wiKS5pbnNlcnQoZGJDb21tZW50c1BheWxvYWQpO1xuICAgICAgaWYgKGNvbW1lbnRFcnIpIHRocm93IGNvbW1lbnRFcnI7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLndhcm4oXCJQZXJzaXN0aW5nIHRvIFN1cGFiYXNlIGZhaWxlZDpcIiwgZXJyKTtcbiAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBcInBlcnNpc3RfZmFpbGVkXCIsIGRldGFpbHM6IFN0cmluZyhlcnIpIH07XG4gIH1cblxuICByZXR1cm4geyBvazogdHJ1ZSwgcG9zdHM6IGNyZWF0ZWRQb3N0cywgY29tbWVudHM6IGNyZWF0ZWRDb21tZW50cyB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJ1bkdlbmVyYXRpb24oYm9keSk7XG4gIGNvbnN0IHN0YXR1cyA9IHJlc3VsdC5vayA/IDIwMCA6IDUwMDtcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3VsdCwgeyBzdGF0dXMgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoKSB7XG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiBmYWxzZSwgZXJyb3I6IFwidXNlX2dlbmVyYXRlX3N0YXJ0XCIsIGRldGFpbHM6IFwiQ2FsbCAvYXBpL2dlbmVyYXRlL3N0YXJ0IHRvIGVucXVldWUgYSBqb2IuXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJzdXBhYmFzZUFkbWluIiwiYXNzaWduUGVyc29uYXNUb1Bvc3RzIiwiY2hpbGRUaW1lc3RhbXAiLCJpc28iLCJtYXhEdXJhdGlvbiIsIlBZX1NFUlZJQ0UiLCJwcm9jZXNzIiwiZW52IiwiUFlUSE9OX1NFUlZJQ0VfVVJMIiwic3VwYWJhc2VDb25maWd1cmVkIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiY2FsbFB5dGhvbiIsInBhdGgiLCJwYXlsb2FkIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiYWJvcnQiLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInNpZ25hbCIsImNhdGNoIiwiZXJyIiwiRXJyb3IiLCJtZXNzYWdlIiwiZmluYWxseSIsImNsZWFyVGltZW91dCIsIm9rIiwidGV4dCIsInN0YXR1cyIsImpzb24iLCJydW5HZW5lcmF0aW9uIiwiY29tcGFueUlkIiwiY29tcGFueV9pZCIsImVycm9yIiwiZGV0YWlscyIsImNvbXBhbnkiLCJwZXJzb25hcyIsImtleXdvcmRzIiwiZmV0Y2hlZFN1YnJlZGRpdCIsImNvbXBhbnlRdWVyeSIsImZyb20iLCJzZWxlY3QiLCJkYXRhIiwiY29tcGFueVJvdyIsImVxIiwic2luZ2xlIiwibGltaXQiLCJjb21wYW55RmlsdGVySWQiLCJwZXJzb25hUm93cyIsImtleXdvcmRSb3dzIiwic3VicmVkZGl0Um93cyIsImxlbmd0aCIsImlkeCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInN1YnJlZGRpdF9uYW1lIiwiY29uc29sZSIsIndhcm4iLCJjb21wYW55X25hbWUiLCJjb21wYW55X2Rlc2NyaXB0aW9uIiwid2Vic2l0ZV91cmwiLCJzdWJyZWRkaXQiLCJwb3N0c19wZXJfd2VlayIsInBlcnNvbmFfdXNlcm5hbWUiLCJwZXJzb25hX2Rlc2NyaXB0aW9uIiwia2V5d29yZF9pZCIsImtleXdvcmRfcGhyYXNlIiwiZWZmZWN0aXZlU3VicmVkZGl0IiwicG9zdHNQZXJXZWVrIiwic2VsZWN0ZWRLZXl3b3JkcyIsImtleXdvcmRSZXMiLCJzZWxlY3RlZCIsInNsaWNlIiwibWFwIiwiayIsIlN0cmluZyIsImFzc2lnbm1lbnRzIiwiY3JlYXRlZFBvc3RzIiwiY3JlYXRlZENvbW1lbnRzIiwicGVyc29uYUNvbW1lbnRDb3VudHMiLCJpIiwia2V5d29yZCIsImFzc2lnbm1lbnQiLCJwZXJzb25hIiwicG9zdEdlbiIsInBvc3RJZCIsInRpbWVzdGFtcCIsImRhdGUiLCJwb3N0Um93IiwicG9zdF9pZCIsInRpdGxlIiwidHJpbSIsImtleXdvcmRfaWRzIiwicHVzaCIsIm1pbkNvbW1lbnRzIiwibWF4Q29tbWVudHMiLCJjb21tZW50Q291bnQiLCJtYXgiLCJtaW4iLCJyb3VuZCIsInBvc3NpYmxlQ29tbWVudGVycyIsImZpbHRlciIsInAiLCJzaHVmZmxlZENvbW1lbnRlcnMiLCJzb3J0IiwiY29tbWVudGVySWR4IiwicGFyZW50VGV4dCIsInBhcmVudElkIiwiYyIsImNvbW1lbnRlciIsImZpbmQiLCJjb21tZW50R2VuIiwicGFyZW50X3RleHQiLCJwb3N0X3RpdGxlIiwicG9zdF9ib2R5IiwiY29tbWVudElkIiwidHMiLCJjYyIsImNvbW1lbnRfaWQiLCJjb21tZW50Um93IiwicGFyZW50X2NvbW1lbnRfaWQiLCJjb21tZW50X3RleHQiLCJwZXJzb25hTWFwIiwiTWFwIiwiZm9yRWFjaCIsInNldCIsInVzZWRQZXJzb25hcyIsIkFycmF5IiwiU2V0IiwiY29uY2F0IiwibWlzc2luZ1BlcnNvbmFzIiwidSIsImhhcyIsInRvVXBzZXJ0IiwidXNlcm5hbWUiLCJwcm90byIsInVwc2VydGVkIiwidXBzZXJ0Iiwib25Db25mbGljdCIsInN1YnJlZGRpdFJvdyIsInNyb3dzIiwicyIsImNyZWF0ZWQiLCJpbnNlcnQiLCJlIiwic2FmZUNvbXBhbnlJZCIsImRiUG9zdHNQYXlsb2FkIiwic3VicmVkZGl0X2lkIiwiaW5zZXJ0ZWRQb3N0cyIsInBvc3RJbnNlcnRFcnJvciIsInBvc3RJZE1hcCIsInJvdyIsImRiQ29tbWVudHNQYXlsb2FkIiwibWF0Y2hJbmRleCIsImZpbmRJbmRleCIsInBwIiwibWFwcGVkUG9zdElkIiwiZ2V0IiwiY29tbWVudEVyciIsInBvc3RzIiwiY29tbWVudHMiLCJQT1NUIiwicmVxIiwicmVzdWx0IiwiR0VUIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate-calendar/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/personas.ts":
/*!*************************!*\
  !*** ./lib/personas.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   assignPersonasToPosts: () => (/* binding */ assignPersonasToPosts),\n/* harmony export */   randomizeWeekSlots: () => (/* binding */ randomizeWeekSlots)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addDays_startOfWeek_date_fns__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,startOfWeek!=!date-fns */ \"(rsc)/./node_modules/date-fns/startOfWeek.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_startOfWeek_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,startOfWeek!=!date-fns */ \"(rsc)/./node_modules/date-fns/addDays.mjs\");\n\nconst timeWindows = [\n    {\n        start: 9,\n        end: 12\n    },\n    {\n        start: 12,\n        end: 15\n    },\n    {\n        start: 15,\n        end: 19\n    }\n];\nfunction randomizeWeekSlots(count) {\n    const today = new Date();\n    const weekStart = (0,_barrel_optimize_names_addDays_startOfWeek_date_fns__WEBPACK_IMPORTED_MODULE_0__.startOfWeek)(today, {\n        weekStartsOn: 1\n    });\n    const days = Array.from({\n        length: 7\n    }, (_, i)=>(0,_barrel_optimize_names_addDays_startOfWeek_date_fns__WEBPACK_IMPORTED_MODULE_1__.addDays)(weekStart, i));\n    const chosen = days.sort(()=>0.5 - Math.random()).slice(0, count);\n    return chosen.map((day)=>{\n        const slot = timeWindows[Math.floor(Math.random() * timeWindows.length)];\n        const hour = slot.start + Math.floor(Math.random() * (slot.end - slot.start));\n        const dt = new Date(day);\n        dt.setHours(hour, Math.floor(Math.random() * 60), 0, 0);\n        return dt;\n    });\n}\nfunction assignPersonasToPosts(personas, postsPerWeek) {\n    if (!personas.length) return [];\n    const assignments = [];\n    const personaCounts = {};\n    const dates = randomizeWeekSlots(postsPerWeek);\n    for(let i = 0; i < postsPerWeek; i++){\n        const sorted = [\n            ...personas\n        ].sort((a, b)=>(personaCounts[a.persona_username] || 0) - (personaCounts[b.persona_username] || 0));\n        const persona = sorted.find((p)=>(personaCounts[p.persona_username] || 0) < 3) || sorted[0];\n        personaCounts[persona.persona_username] = (personaCounts[persona.persona_username] || 0) + 1;\n        assignments.push({\n            persona,\n            date: dates[i]\n        });\n    }\n    return assignments;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcGVyc29uYXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFnRDtBQVloRCxNQUFNRSxjQUFjO0lBQ2xCO1FBQUVDLE9BQU87UUFBR0MsS0FBSztJQUFHO0lBQ3BCO1FBQUVELE9BQU87UUFBSUMsS0FBSztJQUFHO0lBQ3JCO1FBQUVELE9BQU87UUFBSUMsS0FBSztJQUFHO0NBQ3RCO0FBRU0sU0FBU0MsbUJBQW1CQyxLQUFhO0lBQzlDLE1BQU1DLFFBQVEsSUFBSUM7SUFDbEIsTUFBTUMsWUFBWVIsZ0dBQVdBLENBQUNNLE9BQU87UUFBRUcsY0FBYztJQUFFO0lBQ3ZELE1BQU1DLE9BQU9DLE1BQU1DLElBQUksQ0FBQztRQUFFQyxRQUFRO0lBQUUsR0FBRyxDQUFDQyxHQUFHQyxJQUFNaEIsNEZBQU9BLENBQUNTLFdBQVdPO0lBQ3BFLE1BQU1DLFNBQVNOLEtBQUtPLElBQUksQ0FBQyxJQUFNLE1BQU1DLEtBQUtDLE1BQU0sSUFBSUMsS0FBSyxDQUFDLEdBQUdmO0lBQzdELE9BQU9XLE9BQU9LLEdBQUcsQ0FBQyxDQUFDQztRQUNqQixNQUFNQyxPQUFPdEIsV0FBVyxDQUFDaUIsS0FBS00sS0FBSyxDQUFDTixLQUFLQyxNQUFNLEtBQUtsQixZQUFZWSxNQUFNLEVBQUU7UUFDeEUsTUFBTVksT0FDSkYsS0FBS3JCLEtBQUssR0FBR2dCLEtBQUtNLEtBQUssQ0FBQ04sS0FBS0MsTUFBTSxLQUFNSSxDQUFBQSxLQUFLcEIsR0FBRyxHQUFHb0IsS0FBS3JCLEtBQUs7UUFDaEUsTUFBTXdCLEtBQUssSUFBSW5CLEtBQUtlO1FBQ3BCSSxHQUFHQyxRQUFRLENBQUNGLE1BQU1QLEtBQUtNLEtBQUssQ0FBQ04sS0FBS0MsTUFBTSxLQUFLLEtBQUssR0FBRztRQUNyRCxPQUFPTztJQUNUO0FBQ0Y7QUFFTyxTQUFTRSxzQkFDZEMsUUFBbUIsRUFDbkJDLFlBQW9CO0lBRXBCLElBQUksQ0FBQ0QsU0FBU2hCLE1BQU0sRUFBRSxPQUFPLEVBQUU7SUFFL0IsTUFBTWtCLGNBQTRCLEVBQUU7SUFDcEMsTUFBTUMsZ0JBQXdDLENBQUM7SUFDL0MsTUFBTUMsUUFBUTdCLG1CQUFtQjBCO0lBRWpDLElBQUssSUFBSWYsSUFBSSxHQUFHQSxJQUFJZSxjQUFjZixJQUFLO1FBQ3JDLE1BQU1tQixTQUFTO2VBQUlMO1NBQVMsQ0FBQ1osSUFBSSxDQUMvQixDQUFDa0IsR0FBR0MsSUFDRixDQUFDSixhQUFhLENBQUNHLEVBQUVFLGdCQUFnQixDQUFDLElBQUksS0FDckNMLENBQUFBLGFBQWEsQ0FBQ0ksRUFBRUMsZ0JBQWdCLENBQUMsSUFBSTtRQUUxQyxNQUFNQyxVQUNKSixPQUFPSyxJQUFJLENBQUMsQ0FBQ0MsSUFBTSxDQUFDUixhQUFhLENBQUNRLEVBQUVILGdCQUFnQixDQUFDLElBQUksS0FBSyxNQUM5REgsTUFBTSxDQUFDLEVBQUU7UUFFWEYsYUFBYSxDQUFDTSxRQUFRRCxnQkFBZ0IsQ0FBQyxHQUNyQyxDQUFDTCxhQUFhLENBQUNNLFFBQVFELGdCQUFnQixDQUFDLElBQUksS0FBSztRQUVuRE4sWUFBWVUsSUFBSSxDQUFDO1lBQUVIO1lBQVNJLE1BQU1ULEtBQUssQ0FBQ2xCLEVBQUU7UUFBQztJQUM3QztJQUVBLE9BQU9nQjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2xpZGVmb3JnZS1yZWRkaXQtY2FsZW5kYXIvLi9saWIvcGVyc29uYXMudHM/NDM0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhZGREYXlzLCBzdGFydE9mV2VlayB9IGZyb20gXCJkYXRlLWZuc1wiO1xuXG5leHBvcnQgdHlwZSBQZXJzb25hID0ge1xuICBwZXJzb25hX3VzZXJuYW1lOiBzdHJpbmc7XG4gIHBlcnNvbmFfZGVzY3JpcHRpb246IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIEFzc2lnbm1lbnQgPSB7XG4gIHBlcnNvbmE6IFBlcnNvbmE7XG4gIGRhdGU6IERhdGU7XG59O1xuXG5jb25zdCB0aW1lV2luZG93cyA9IFtcbiAgeyBzdGFydDogOSwgZW5kOiAxMiB9LFxuICB7IHN0YXJ0OiAxMiwgZW5kOiAxNSB9LFxuICB7IHN0YXJ0OiAxNSwgZW5kOiAxOSB9XG5dO1xuXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9taXplV2Vla1Nsb3RzKGNvdW50OiBudW1iZXIpOiBEYXRlW10ge1xuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKHRvZGF5LCB7IHdlZWtTdGFydHNPbjogMSB9KTtcbiAgY29uc3QgZGF5cyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDcgfSwgKF8sIGkpID0+IGFkZERheXMod2Vla1N0YXJ0LCBpKSk7XG4gIGNvbnN0IGNob3NlbiA9IGRheXMuc29ydCgoKSA9PiAwLjUgLSBNYXRoLnJhbmRvbSgpKS5zbGljZSgwLCBjb3VudCk7XG4gIHJldHVybiBjaG9zZW4ubWFwKChkYXkpID0+IHtcbiAgICBjb25zdCBzbG90ID0gdGltZVdpbmRvd3NbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGltZVdpbmRvd3MubGVuZ3RoKV07XG4gICAgY29uc3QgaG91ciA9XG4gICAgICBzbG90LnN0YXJ0ICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHNsb3QuZW5kIC0gc2xvdC5zdGFydCkpO1xuICAgIGNvbnN0IGR0ID0gbmV3IERhdGUoZGF5KTtcbiAgICBkdC5zZXRIb3Vycyhob3VyLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2MCksIDAsIDApO1xuICAgIHJldHVybiBkdDtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NpZ25QZXJzb25hc1RvUG9zdHMoXG4gIHBlcnNvbmFzOiBQZXJzb25hW10sXG4gIHBvc3RzUGVyV2VlazogbnVtYmVyXG4pOiB7IHBlcnNvbmE6IFBlcnNvbmE7IGRhdGU6IERhdGUgfVtdIHtcbiAgaWYgKCFwZXJzb25hcy5sZW5ndGgpIHJldHVybiBbXTtcblxuICBjb25zdCBhc3NpZ25tZW50czogQXNzaWdubWVudFtdID0gW107XG4gIGNvbnN0IHBlcnNvbmFDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgY29uc3QgZGF0ZXMgPSByYW5kb21pemVXZWVrU2xvdHMocG9zdHNQZXJXZWVrKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHBvc3RzUGVyV2VlazsgaSsrKSB7XG4gICAgY29uc3Qgc29ydGVkID0gWy4uLnBlcnNvbmFzXS5zb3J0KFxuICAgICAgKGEsIGIpID0+XG4gICAgICAgIChwZXJzb25hQ291bnRzW2EucGVyc29uYV91c2VybmFtZV0gfHwgMCkgLVxuICAgICAgICAocGVyc29uYUNvdW50c1tiLnBlcnNvbmFfdXNlcm5hbWVdIHx8IDApXG4gICAgKTtcbiAgICBjb25zdCBwZXJzb25hID1cbiAgICAgIHNvcnRlZC5maW5kKChwKSA9PiAocGVyc29uYUNvdW50c1twLnBlcnNvbmFfdXNlcm5hbWVdIHx8IDApIDwgMykgfHxcbiAgICAgIHNvcnRlZFswXTtcblxuICAgIHBlcnNvbmFDb3VudHNbcGVyc29uYS5wZXJzb25hX3VzZXJuYW1lXSA9XG4gICAgICAocGVyc29uYUNvdW50c1twZXJzb25hLnBlcnNvbmFfdXNlcm5hbWVdIHx8IDApICsgMTtcblxuICAgIGFzc2lnbm1lbnRzLnB1c2goeyBwZXJzb25hLCBkYXRlOiBkYXRlc1tpXSB9KTtcbiAgfVxuXG4gIHJldHVybiBhc3NpZ25tZW50cztcbn1cbiJdLCJuYW1lcyI6WyJhZGREYXlzIiwic3RhcnRPZldlZWsiLCJ0aW1lV2luZG93cyIsInN0YXJ0IiwiZW5kIiwicmFuZG9taXplV2Vla1Nsb3RzIiwiY291bnQiLCJ0b2RheSIsIkRhdGUiLCJ3ZWVrU3RhcnQiLCJ3ZWVrU3RhcnRzT24iLCJkYXlzIiwiQXJyYXkiLCJmcm9tIiwibGVuZ3RoIiwiXyIsImkiLCJjaG9zZW4iLCJzb3J0IiwiTWF0aCIsInJhbmRvbSIsInNsaWNlIiwibWFwIiwiZGF5Iiwic2xvdCIsImZsb29yIiwiaG91ciIsImR0Iiwic2V0SG91cnMiLCJhc3NpZ25QZXJzb25hc1RvUG9zdHMiLCJwZXJzb25hcyIsInBvc3RzUGVyV2VlayIsImFzc2lnbm1lbnRzIiwicGVyc29uYUNvdW50cyIsImRhdGVzIiwic29ydGVkIiwiYSIsImIiLCJwZXJzb25hX3VzZXJuYW1lIiwicGVyc29uYSIsImZpbmQiLCJwIiwicHVzaCIsImRhdGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/personas.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   supabaseClient: () => (/* binding */ supabaseClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/esm/wrapper.mjs\");\n\nconst supabaseUrl = \"https://pvrgybkyonzonmzryckv.supabase.co\";\nconst supabaseAnon = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2cmd5Ymt5b256b25tenJ5Y2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NDY5NjAsImV4cCI6MjA4MTIyMjk2MH0.iHuDMKc-TxYu9pNiTDdtDEIrJNUL4Vh_zul1P2OrhK0\";\nconst supabaseService = process.env.SUPABASE_SERVICE_ROLE_KEY || supabaseAnon;\nconst supabaseClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnon);\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseService);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXFEO0FBRXJELE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxlQUFlSCxrTkFBeUM7QUFDOUQsTUFBTUssa0JBQWtCTCxRQUFRQyxHQUFHLENBQUNLLHlCQUF5QixJQUFJSDtBQUUxRCxNQUFNSSxpQkFBaUJULG1FQUFZQSxDQUFDQyxhQUFhSSxjQUFjO0FBRS9ELE1BQU1LLGdCQUFnQlYsbUVBQVlBLENBQUNDLGFBQWFNLGlCQUFpQiIsInNvdXJjZXMiOlsid2VicGFjazovL3NsaWRlZm9yZ2UtcmVkZGl0LWNhbGVuZGFyLy4vbGliL3N1cGFiYXNlLnRzP2M5OWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCE7XG5jb25zdCBzdXBhYmFzZUFub24gPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSE7XG5jb25zdCBzdXBhYmFzZVNlcnZpY2UgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8IHN1cGFiYXNlQW5vbjtcblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlQ2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub24pO1xuXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlKTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub24iLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInN1cGFiYXNlU2VydmljZSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJzdXBhYmFzZUNsaWVudCIsInN1cGFiYXNlQWRtaW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ }),

/***/ "(rsc)/./lib/timestamps.ts":
/*!***************************!*\
  !*** ./lib/timestamps.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   childTimestamp: () => (/* binding */ childTimestamp),\n/* harmony export */   iso: () => (/* binding */ iso)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_addMinutes_date_fns__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! __barrel_optimize__?names=addMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/addMinutes.mjs\");\n\nfunction iso(date) {\n    return date.toISOString();\n}\nfunction childTimestamp(parent) {\n    const base = new Date(parent);\n    const offset = 5 + Math.floor(Math.random() * 15);\n    return iso((0,_barrel_optimize_names_addMinutes_date_fns__WEBPACK_IMPORTED_MODULE_0__.addMinutes)(base, offset));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvdGltZXN0YW1wcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0M7QUFFL0IsU0FBU0MsSUFBSUMsSUFBVTtJQUM1QixPQUFPQSxLQUFLQyxXQUFXO0FBQ3pCO0FBRU8sU0FBU0MsZUFBZUMsTUFBYztJQUMzQyxNQUFNQyxPQUFPLElBQUlDLEtBQUtGO0lBQ3RCLE1BQU1HLFNBQVMsSUFBSUMsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxNQUFNLEtBQUs7SUFDOUMsT0FBT1YsSUFBSUQsc0ZBQVVBLENBQUNNLE1BQU1FO0FBQzlCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2xpZGVmb3JnZS1yZWRkaXQtY2FsZW5kYXIvLi9saWIvdGltZXN0YW1wcy50cz9mZDBmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFkZE1pbnV0ZXMgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzbyhkYXRlOiBEYXRlKSB7XG4gIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGlsZFRpbWVzdGFtcChwYXJlbnQ6IHN0cmluZykge1xuICBjb25zdCBiYXNlID0gbmV3IERhdGUocGFyZW50KTtcbiAgY29uc3Qgb2Zmc2V0ID0gNSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE1KTtcbiAgcmV0dXJuIGlzbyhhZGRNaW51dGVzKGJhc2UsIG9mZnNldCkpO1xufVxuIl0sIm5hbWVzIjpbImFkZE1pbnV0ZXMiLCJpc28iLCJkYXRlIiwidG9JU09TdHJpbmciLCJjaGlsZFRpbWVzdGFtcCIsInBhcmVudCIsImJhc2UiLCJEYXRlIiwib2Zmc2V0IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/timestamps.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/date-fns","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-calendar%2Froute&page=%2Fapi%2Fgenerate-calendar%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-calendar%2Froute.ts&appDir=C%3A%5CRepos%5Creddit_mastermind_assessment%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5Creddit_mastermind_assessment&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();